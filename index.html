<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Impostor F√∫tbol ‚Äì Men√∫</title>

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Paleta arcade/pixel */
      --bg-deep:#0b2a44;
      --bg-mid:#123a5f;
      --grass-1:#2a9a3a;
      --grass-2:#187b2b;
      --line:#cdeccf;

      --btn-blue:#1e53a4;
      --btn-blue-2:#163a77;
      --btn-green:#2f8b3a;
      --btn-green-2:#1f6028;
      --btn-yellow:#f5b019;
      --btn-yellow-2:#c88411;

      --btn-outline:#0b2244;
      --text:#f5f7ff;
      --shadow:#061428;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    /* ===== Fondo estilo estadio pixel (CSS puro) ===== */
    body{
      margin:0;
      color:var(--text);
      font-family:"Press Start 2P", system-ui, monospace;
      image-rendering: pixelated;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      text-align:center;
      background:
        /* estrellas */
        radial-gradient(2px 2px at 10% 12%, #fff8 70%, #0000 71%),
        radial-gradient(2px 2px at 40% 20%, #fff8 70%, #0000 71%),
        radial-gradient(2px 2px at 75% 15%, #fff8 70%, #0000 71%),
        radial-gradient(2px 2px at 20% 35%, #fff8 70%, #0000 71%),
        radial-gradient(2px 2px at 60% 30%, #fff8 70%, #0000 71%),
        /* grada */
        linear-gradient(var(--bg-mid), var(--bg-mid)) 0 45%/100% 18% no-repeat,
        /* barandas */
        linear-gradient(#0e2b49, #0e2b49) 0 62%/100% 2% no-repeat,
        linear-gradient(#0a2541, #0a2541) 0 66%/100% 2% no-repeat,
        /* c√©sped bandas */
        repeating-linear-gradient(180deg,
          var(--grass-1) 0 40px,
          var(--grass-2) 40px 80px) 0 100%/100% 40% no-repeat,
        /* l√≠nea central */
        linear-gradient(var(--line), var(--line)) 50% calc(100% - 20%) / 4px 40% no-repeat,
        /* cielo */
        linear-gradient(180deg, var(--bg-deep) 0%, #0e3155 50%, #0e3155 50%, #0b2a44 100%);
      min-height:100vh;
      padding:40px 16px;
    }

    /* ===== T√≠tulo ===== */
    .title{
      font-size:clamp(28px, 4vw, 64px);
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:2px;
      margin:0 0 28px;
      text-shadow:
        0 6px 0 #09223d,
        0 10px 16px #0008;
      line-height:1.2;
    }
    .title span{ color:#ffd84d; text-shadow:0 4px 0 #a56e00; }
    .title .ball{ filter: drop-shadow(0 6px 0 #09223d) drop-shadow(0 10px 16px #0008); }

    /* ===== Botones (conserva .menu-btn y .yellow) ===== */
    .menu-btn{
      --bg: var(--btn-blue);
      --bg2: var(--btn-blue-2);
      --txtshadow:#082040;

      display:flex; align-items:center; justify-content:center; gap:14px;
      width:min(780px, 92vw);
      padding:22px 26px;
      margin:14px auto;
      font-size:clamp(14px, 1.9vw, 28px);
      font-weight:800;
      text-decoration:none;
      color:var(--text);
      cursor:pointer;

      /* marco 8-bit + sombras escalonadas */
      background:
        linear-gradient(180deg, #ffffff0a, #00000020),
        linear-gradient(180deg, var(--bg2), var(--bg));
      border:0;
      border-radius:6px;
      box-shadow:
        0 0 0 4px var(--btn-outline),
        0 0 0 8px #ffd84d,
        0 10px 0 0 var(--shadow);
      text-shadow:0 3px 0 var(--txtshadow);
      transition: transform .06s steps(2), box-shadow .06s steps(2), filter .06s steps(2);
    }
    .menu-btn:hover{
      transform: translateY(-3px);
      box-shadow:
        0 0 0 4px var(--btn-outline),
        0 0 0 8px #ffea83,
        0 14px 0 0 var(--shadow);
      filter: saturate(1.05) brightness(1.03);
    }
    .menu-btn:active{
      transform: translateY(0);
      box-shadow:
        0 0 0 4px var(--btn-outline),
        0 0 0 8px #e9c74d,
        0 6px 0 0 var(--shadow);
    }

    /* variantes */
    .yellow{
      --bg:var(--btn-yellow);
      --bg2:var(--btn-yellow-2);
      --txtshadow:#7a4f00;
      color:#04244a;
    }
    /* bot√≥n verde (Offline del mockup) */
    #link-offline{
      --bg:var(--btn-green);
      --bg2:var(--btn-green-2);
      --txtshadow:#08331a;
      color:#f0fff0;
    }

    /* Badge ‚ÄúAZAR‚Äù tipo c√°psula */
    .caps{
      display:inline-block;
      padding:6px 10px;
      margin-left:10px;
      background:#0b2a68;
      color:#e6f1ff;
      border:3px solid #07224f;
      box-shadow: inset 0 -3px 0 #061a3a, 0 3px 0 #061a3a;
      border-radius:4px;
      font-size:0.75em;
    }

    /* ===== Modal nombre + avatar (mantengo Outfit para legibilidad) ===== */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;place-items:center;z-index:60}
    .name-card{width:min(480px,92vw);background:#0b1220;color:#fff;border:1px solid rgba(255,255,255,.18);
      border-radius:16px;padding:18px;box-shadow:0 30px 60px rgba(0,0,0,.6);font-family:"Outfit",sans-serif}
    .name-card h3{margin:0 0 8px;font-size:22px}
    .name-card p{margin:0 0 14px;opacity:.9}
    .name-row{display:flex;gap:10px}
    .name-input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.25);
      background:#0f172a;color:#fff;font-size:16px;outline:none}
    .name-input:focus{border-color:#38bdf8}
    .name-btn{padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.35);cursor:pointer;
      background:linear-gradient(180deg,#facc15,#eab308);color:#111;font-weight:900}
    .name-error{margin-top:8px;font-size:13px;color:#fb7185;min-height:18px}

    /* ===== Selector de avatar ===== */
    .avatar-grid{display:grid;grid-template-columns:repeat(6,56px);gap:10px;justify-content:center;margin-top:12px}
    .avatar-opt{width:56px;height:56px;border-radius:50%;overflow:hidden;cursor:pointer;border:2px solid transparent;background:#0f172a;display:grid;place-items:center}
    .avatar-opt img{width:100%;height:100%;object-fit:cover;display:block}
    .avatar-opt.selected{border-color:#facc15;box-shadow:0 0 0 3px rgba(250,204,21,.35)}

    .avatar-hint{margin:8px 0 0;font-size:13px;opacity:.85;font-family:"Outfit",sans-serif}
  </style>
</head>
<body>
  <div class="title">IMPOSTOR <span>F√öTBOL</span> <span class="ball">‚öΩ</span></div>

  <a id="link-crear"    class="menu-btn yellow" href="crear.html">üèÜ CREAR SALA</a>
  <a id="link-offline"  class="menu-btn"        href="offline.html">üö© Offline</a>
  <a id="link-ingresar" class="menu-btn"        href="ingresar.html">üîë INGRESAR A SALA</a>
  <button id="btn-azar"  class="menu-btn yellow">üé≤ UNIRSE AL <span class="caps">AZAR</span></button>

  <!-- ===== Perfil (nombre + avatar) ===== -->
  <script>
    // Avatares disponibles (ajust√° rutas reales)
   const AVATARS = [
  {key:"messi",   src:"avatars/messi.png"},
  {key:"neymar",  src:"avatars/neymar.png"},
  {key:"mbappe",  src:"avatars/mbappe.png"},
  {key:"cr7",     src:"avatars/cr7.png"},
  {key:"dibu",    src:"avatars/dibu.png"},
  {key:"haaland", src:"avatars/haaland.png"}
];

    window.PlayerProfile = {
      getName(){ return localStorage.getItem("displayName") || ""; },
      setName(n){ localStorage.setItem("displayName", n); },
      getAvatar(){ return localStorage.getItem("avatarKey") || ""; },
      setAvatar(k){ localStorage.setItem("avatarKey", k); },

      async ensure(){
        let name = this.getName();
        let avatar = this.getAvatar();
        if (valid(name) && avatar) return {name, avatar};

        const modal = document.getElementById("name-modal");
        const input = document.getElementById("displayName");
        const btn   = document.getElementById("saveName");
        const errEl = document.getElementById("nameError");
        const grid  = document.getElementById("avatarGrid");
        const close = ()=>{ modal.style.display="none"; modal.setAttribute("aria-hidden","true"); };

        // Render opciones avatar
        grid.innerHTML = "";
        AVATARS.forEach(a=>{
          const b = document.createElement("button");
          b.type = "button"; b.className = "avatar-opt";
          b.innerHTML = `<img src="${a.src}" alt="${a.key}" />`;
          if ((avatar||"") === a.key) b.classList.add("selected");
          b.addEventListener("click", ()=>{
            document.querySelectorAll(".avatar-opt").forEach(x=>x.classList.remove("selected"));
            b.classList.add("selected");
            avatar = a.key;
          });
          grid.appendChild(b);
        });

        modal.style.display="grid";
        modal.setAttribute("aria-hidden","false");
        input.value = this.getName() || ""; input.focus();

        return new Promise((resolve)=>{
          const save = ()=>{
            const v = (input.value||"").trim();
            if(!valid(v)){ errEl.textContent = "Us√° entre 2 y 16 caracteres."; return; }
            if(!avatar){ errEl.textContent = "Eleg√≠ un avatar."; return; }
            this.setName(v);
            this.setAvatar(avatar);
            errEl.textContent = "";
            close();
            resolve({name:v, avatar});
          };
          btn.onclick = save;
          input.onkeydown = (e)=>{ if(e.key==="Enter") save(); if(e.key==="Escape") close(); };
          modal.onclick = (e)=>{ if(e.target===modal){ input.focus(); } };
        });

        function valid(s){ return typeof s==="string" && s.trim().length>=2 && s.trim().length<=16; }
      }
    };
  </script>

  <!-- ===== Firebase + acciones ===== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    (async () => {
      try {
        const firebaseConfig = {
          apiKey: "AIzaSyAegeue7A8qFFW4IScFFgtvT4P1g2GLkCM",
          authDomain: "who-is-who-6ea99.firebaseapp.com",
          projectId: "who-is-who-6ea99",
          storageBucket: "who-is-who-6ea99.firebasestorage.app",
          messagingSenderId: "718537140049",
          appId: "1:718537140049:web:7400ec7e5467b387f8d570",
          measurementId: "G-KNC4FJXXBN"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        try { await signInAnonymously(auth); }
        catch (e) { console.warn("Anon auth fall√≥ (seguimos igual):", e); }

        // Unirse al azar
        const btnAzar = document.getElementById("btn-azar");
        if (btnAzar) {
          btnAzar.addEventListener("click", async () => {
            try {
              const {name, avatar} = await window.PlayerProfile.ensure();

              const snap = await getDocs(collection(db, "rooms"));
              if (snap.empty) { alert("No hay salas disponibles todav√≠a."); return; }
              const rooms = snap.docs.map(d => d.id);
              const code = rooms[Math.floor(Math.random() * rooms.length)];

              location.href = `crear.html?code=${code}&name=${encodeURIComponent(name)}&avatar=${encodeURIComponent(avatar)}`;
            } catch (err) {
              console.error(err);
              alert("No pude listar salas. Prob√° refrescar o crear una sala.");
            }
          });
        }
      } catch (err) {
        console.error("Error inicializando Firebase:", err);
      }
    })();
  </script>

  <!-- ===== Modal nombre + avatar ===== -->
  <div id="name-modal" class="backdrop" aria-hidden="true">
    <div class="name-card" role="dialog" aria-modal="true" aria-labelledby="name-title">
      <h3 id="name-title">Eleg√≠ tu nombre</h3>
      <p>Este ser√° el nombre y avatar que ver√°n los dem√°s jugadores.</p>
      <div class="name-row">
        <input id="displayName" class="name-input" type="text" maxlength="16" placeholder="Ej: Nico, Lio üêê" />
        <button id="saveName" class="name-btn">Guardar</button>
      </div>
      <div id="nameError" class="name-error"></div>
      <div class="avatar-grid" id="avatarGrid"></div>
      <div class="avatar-hint">Eleg√≠ tu avatar</div>
    </div>
  </div>

  <!-- ===== Navegaci√≥n que exige perfil ===== -->
  <script>
    document.addEventListener("DOMContentLoaded", ()=>{
      const linkCrear    = document.getElementById("link-crear");
      const linkIngresar = document.getElementById("link-ingresar");

      async function goWithProfile(url){
        const {name, avatar} = await window.PlayerProfile.ensure();
        const sep  = url.includes("?") ? "&" : "?";
        location.href = `${url}${sep}name=${encodeURIComponent(name)}&avatar=${encodeURIComponent(avatar)}`.
          replace(/\s/g, "%20");
      }

      linkCrear?.addEventListener("click", (e)=>{ e.preventDefault(); goWithProfile("crear.html"); });
      linkIngresar?.addEventListener("click", (e)=>{ e.preventDefault(); goWithProfile("ingresar.html"); });

      // Si quer√©s que Offline tambi√©n pida perfil:
      // document.getElementById("link-offline")?.addEventListener("click", (e)=>{ e.preventDefault(); goWithProfile("offline.html"); });
    });
  </script>
</body>
</html>
