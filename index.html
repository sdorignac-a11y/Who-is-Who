<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Impostor Fútbol – Menú</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body{margin:0;font-family:"Outfit",sans-serif;background:url("fondo-cancha.png") center/cover fixed no-repeat;color:#fff;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}
    .title{font-size:60px;font-weight:900;text-transform:uppercase;text-shadow:0 4px 12px rgba(0,0,0,.6);margin-bottom:40px}
    .title span{color:#4ade80}
    .menu-btn{display:flex;align-items:center;justify-content:center;gap:10px;width:320px;padding:16px 24px;margin:12px 0;font-size:24px;font-weight:800;border-radius:12px;cursor:pointer;border:2px solid #ffd43b;color:#fff;background:linear-gradient(180deg,#1e40af,#1e3a8a);box-shadow:0 6px 16px rgba(0,0,0,.5);transition:.1s}
    .menu-btn:hover{filter:brightness(1.1)} .menu-btn:active{transform:translateY(2px)}
    .yellow{background:linear-gradient(180deg,#facc15,#eab308);color:#111;border-color:#fff176}
  </style>
</head>
<body>
  <div class="title">Impostor <span>Fútbol</span> ⚽</div>

  <!-- Link directo: navega aunque el JS falle -->
  <a id="btn-crear" class="menu-btn yellow" href="crear.html">🏟️ CREAR SALA</a>
  <a id="btn-crear" class="menu-btn yellow" href="offline.html">🏟️ Offline</a>
  <a class="menu-btn" href="ingresar.html">🔑 INGRESAR A SALA</a>
  <button id="btn-azar" class="menu-btn yellow">🎲 UNIRSE AL AZAR</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    (async () => {
      try {
        const firebaseConfig = {
          apiKey: "AIzaSyAegeue7A8qFFW4IScFFgtvT4P1g2GLkCM",
          authDomain: "who-is-who-6ea99.firebaseapp.com",
          projectId: "who-is-who-6ea99",
          storageBucket: "who-is-who-6ea99.firebasestorage.app",
          messagingSenderId: "718537140049",
          appId: "1:718537140049:web:7400ec7e5467b387f8d570",
          measurementId: "G-KNC4FJXXBN"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Autenticación anónima (no bloquea si falla)
        try { await signInAnonymously(auth); }
        catch (e) { console.warn("Anon auth falló (seguimos igual):", e); }

        // Unirse al azar (si Firestore funciona)
        const btnAzar = document.getElementById("btn-azar");
        if (btnAzar) {
          btnAzar.addEventListener("click", async () => {
            try {
              const snap = await getDocs(collection(db, "rooms"));
              if (snap.empty) { alert("No hay salas disponibles todavía."); return; }
              const rooms = snap.docs.map(d => d.id);
              const code = rooms[Math.floor(Math.random() * rooms.length)];
              location.href = "crear.html?code=" + code;
            } catch (err) {
              console.error(err);
              alert("No pude listar salas. Probá refrescar o crear una sala.");
            }
          });
        }
      } catch (err) {
        console.error("Error inicializando Firebase:", err);
        // El link de CREAR SALA sigue funcionando igual.
      }
    })();
  </script>

  <!-- Consejo: serví los archivos con un server local para evitar problemas de CORS con módulos.
       Ej: `python3 -m http.server 5500` y abrí http://localhost:5500/index.html -->
</body>
</html>
