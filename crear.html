<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Impostor F√∫tbol ‚Äì Lobby</title>

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Estilos externos -->
  <link rel="stylesheet" href="./crear.css">
</head>
<body>
  <script>window.__loaderStart = performance.now();</script>

  <!-- Overlay de carga -->
  <div id="loader-overlay" aria-hidden="false" role="status">
    <div class="loader-card">
      <div class="spinner" aria-hidden="true"></div>
      <div>
        <div style="font-weight:800">Cargando el sitio‚Ä¶</div>
        <div style="opacity:.8;font-size:12px">Preparando todo (5s)</div>
      </div>
    </div>
  </div>

  <div id="app-wrapper" class="hidden">
    <!-- Sprite de √≠conos (dejado ac√° para evitar rutas adicionales) -->
    <svg width="0" height="0" style="position:absolute;left:-9999px;top:-9999px" aria-hidden="true">
      <symbol id="i-user" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12a5 5 0 1 0-5-5a5 5 0 0 0 5 5m0 2c-4.42 0-8 2.24-8 5v1h16v-1c0-2.76-3.58-5-8-5"/></symbol>
      <symbol id="i-crown" viewBox="0 0 24 24"><path fill="currentColor" d="M2 7l4 3l4-5l4 5l4-3l2 12H0z"/></symbol>
      <symbol id="i-eye" viewBox="0 0 24 24"><path fill="currentColor" d="M12 5c7 0 10 7 10 7s-3 7-10 7S2 12 2 12s3-7 10-7m0 3a4 4 0 1 0 0 8a4 4 0 0 0 0-8"/></symbol>
      <symbol id="i-eye-off" viewBox="0 0 24 24"><path fill="currentColor" d="M2 4.27L3.28 3L21 20.72L19.73 22l-3.03-3.03A10.9 10.9 0 0 1 12 19c-7 0-10-7-10-7a18.7 18.7 0 0 1 5.31-6.04L2 4.27M12 7a5 5 0 0 1 5 5c0 .88-.24 1.69-.66 2.39L9.61 7.66A4.9 4.9 0 0 1 12 7Z"/></symbol>
      <symbol id="i-lock" viewBox="0 0 24 24"><path fill="currentColor" d="M12 1a5 5 0 0 1 5 5v3h1a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h1V6a5 5 0 0 1 5-5m3 8V6a3 3 0 1 0-6 0v3z"/></symbol>
      <symbol id="i-globe" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2m6.92 6h-3.26A14.4 14.4 0 0 0 15 4.46A8 8 0 0 1 18.92 8M12 4a12.5 12.5 0 0 1 1.84 4H10.2A12.5 12.5 0 0 1 12 4M5.08 8A8 8 0 0 1 9 4.46A14.4 14.4 0 0 0 8.34 8zm13.84 8h-3.26c.26-.9.45-1.9.58-3h3.5a8 8 0 0 1-.82 3M10.2 17H13.8a12.5 12.5 0 0 1-1.8 3a12.5 12.5 0 0 1-1.8-3M4.58 13h3.5c.12 1.1.32 2.1.58 3H5.42A8 8 0 0 1 4.58 13"/></symbol>
      <symbol id="i-whistle" viewBox="0 0 24 24"><path fill="currentColor" d="M17 6h5v5h-2a7 7 0 1 1-7-7h4z"/></symbol>
      <symbol id="i-ball" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2m1 3l3 2l-1 3l-3 1l-3-1l-1-3l3-2zm-8 7l2-3l3 1l1 3l-2 2l-3-1zm14 0l-3 1l-2-2l1-3l3-1l1 3zM9 19l1-3l3-1l3 1l-1 3l-3 1z"/></symbol>
      <symbol id="i-x" viewBox="0 0 24 24"><path fill="currentColor" d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12z"/></symbol>
      <symbol id="i-chevron" viewBox="0 0 24 24"><path fill="currentColor" d="M9 6l6 6l-6 6"/></symbol>
    </svg>

    <!-- ====== CONTENIDO ====== -->
    <div class="container">
      <div class="room-card">
        <div class="brand"><div class="ball"></div><h1>Impostor <span>F√∫tbol</span></h1></div>
        <div class="code-box">
          <strong style="opacity:.7">C√ìDIGO:</strong>
          <div class="room-code" id="roomCode">‚Äî</div>
          <button id="toggleCodeBtn" class="btn">üëÅÔ∏è Mostrar c√≥digo</button>
          <button id="copyBtn" class="btn">Copiar</button>
        </div>
        <div class="user-area">
          <div class="userbox">
            <svg class="icon"><use href="#i-user"></use></svg>
            <span id="meName">‚Äî</span>
            <button id="editName" class="mini-btn">Editar</button>
          </div>
          <button id="shareBtn" class="btn">Compartir enlace</button>
        </div>
      </div>

      <!-- Layout principal -->
      <div class="lobby-layout">
        <main class="main-col">
          <div class="players" id="players"></div>

          <div class="settings settings-top">
            <div class="card">
              <h3>Impostores</h3>
              <div class="selector">
                <div class="arrow" data-dec="impostores">‚Äπ</div>
                <div class="value" id="impostoresVal">1</div>
                <div class="arrow" data-inc="impostores">‚Ä∫</div>
              </div>
            </div>

            <div class="card">
              <h3>Jugadores</h3>
              <div class="selector">
                <div class="arrow" data-dec="jugadores">‚Äπ</div>
                <div class="value" id="jugadoresVal">8</div>
                <div class="arrow" data-inc="jugadores">‚Ä∫</div>
              </div>
            </div>

            <div class="card">
              <h3>Tema</h3>
              <div class="selector">
                <div class="arrow" data-dec="tema">‚Äπ</div>
                <div class="value" id="temaVal">Clubes</div>
                <div class="arrow" data-inc="tema">‚Ä∫</div>
              </div>
            </div>
          </div>

          <div class="settings settings-bottom">
            <div class="card">
              <h3>Tiempo</h3>
              <div class="selector">
                <div class="arrow" data-dec="tiempo">‚Äπ</div>
                <div class="value" id="tiempoVal">60s</div>
                <div class="arrow" data-inc="tiempo">‚Ä∫</div>
              </div>
            </div>

            <div class="card">
              <h3>Privacidad</h3>
              <div class="selector" style="justify-content:center">
                <button id="togglePrivacyBtn" class="btn icon-btn">
                  <svg class="icon"><use href="#i-lock"></use></svg> Privada
                </button>
                <small id="privacyHint" style="opacity:.8;font-weight:700">Solo con c√≥digo</small>
              </div>
            </div>
          </div>

          <div class="cta">
            <button id="startBtn" class="btn-cta">EMPEZAR PARTIDA</button>
            <button id="leaveBtn" class="btn" style="display:none">ABANDONAR PARTIDA</button>
            <button id="deleteRoomBtn" class="btn" style="display:none;background:linear-gradient(180deg,#ea4335,#c92e21);border-color:#ffb3ac">ELIMINAR SALA</button>
          </div>
        </main>

        <!-- Chat de lobby -->
        <aside class="side-col">
          <div class="chat-card">
            <div class="chat-head">
              <h3>Chat de la sala</h3>
              <small id="lobbyChatHint">Chate√° mientras esperan</small>
            </div>
            <div id="lobbyChatList" class="chat-list"></div>
            <form id="lobbyChatForm" class="chat-form">
              <input id="lobbyChatInput" maxlength="180" placeholder="Escrib√≠ un mensaje‚Ä¶">
              <button class="btn" type="submit">Enviar</button>
            </form>
          </div>
        </aside>
      </div>

      <!-- Overlays / Debate -->
      <div id="reveal">
        <div class="rev-card">
          <h2 style="margin:0 0 10px;font-size:clamp(18px,6vw,24px)">Tu rol</h2>
          <div id="revContent" class="rev-content"></div>
          <div id="countdown" style="margin-top:12px;font-size:clamp(16px,5.3vw,22px);font-weight:700;color:#f6c11b">Pasando en 10s...</div>
        </div>
      </div>

      <div id="drawOverlay">
        <div class="draw-card">
          <h2 class="draw-title" style="font-size:clamp(18px,6vw,24px)">Sorteo del orden</h2>
          <div class="bowl" id="bowl">
            <div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div><div class="ball"></div>
            <div class="slip" id="slip">‚Äî</div>
          </div>
          <div id="orderList" class="order-list"></div>
        </div>
      </div>

      <div id="resultsOverlay" style="display:none;position:fixed;inset:0;z-index:1400;place-items:center;background:rgba(0,10,20,.9);padding:16px">
        <div class="rev-card" style="width:min(680px,96vw)">
          <h2 style="margin:0 0 10px;font-size:clamp(18px,6vw,24px)">Resultados</h2>
          <div id="resultsBox" class="rev-content"></div>
          <div class="tip" id="resultsSub" style="margin-top:10px;opacity:.9"></div>
        </div>
      </div>

      <!-- Fase debate -->
      <div id="phaseDiscuss" class="debate-shell" style="display:none">
        <div class="debate-card">
          <div id="turnBanner">
            <svg class="icon" style="width:1.1em;height:1.1em;vertical-align:-.15em"><use href="#i-ball"></use></svg>
            Va <span id="turnName" class="who">‚Äî</span>
          </div>

          <div id="graffitiBanner"><span id="graffitiText"></span></div>

          <div class="debate-head">
            <h2 class="debate-title">Debate</h2>
            <div class="debate-meta">
              <small id="timer" style="font-weight:800"></small>
              <small id="turnHint"></small>
              <small id="cooldownHint"></small>
            </div>
          </div>

          <div class="debate-wrap">
            <section class="debate-chat">
              <div id="firstWordTip" class="tip debate-tips" style="display:none">
                Primero, cada jugador debe enviar <strong>UNA</strong> palabra (2‚Äì24 letras). Despu√©s, chat libre.
              </div>
              <div id="chatList" class="debate-list"></div>
              <form id="chatForm" class="debate-form">
                <input id="chatInput" maxlength="140" class="debate-input" placeholder="Primero UNA palabra (2‚Äì24 letras)‚Ä¶">
                <button class="btn" type="submit">Enviar</button>
              </form>
            </section>

            <aside class="debate-side">
              <div class="side-section">
                <h3 class="side-title">Ronda</h3>
                <div class="side-row">
                  <small>Tiempo</small>
                  <small id="timerMirror"></small>
                </div>
              </div>

              <div class="side-section" style="border-bottom:0">
                <h3 class="side-title">Jugadores</h3>
                <div id="sidePlayers" class="side-players"></div>
              </div>

              <div class="side-section" id="voteSection">
                <h3 class="side-title">Votar</h3>
                <div id="voteBar"></div>
              </div>
            </aside>
          </div>
        </div>
      </div>

      <!-- Toast -->
      <div id="toast" role="status" aria-live="polite"></div>
    </div>
  </div>

  <!-- Loader minimal JS (queda inline a prop√≥sito) -->
  <script>
    (function(){
      const MIN_LOADING_MS = 5000;
      const overlay = document.getElementById('loader-overlay');
      const app = document.getElementById('app-wrapper');
      const start = window.__loaderStart || performance.now();

      function finishLoading(){
        overlay.classList.add('hidden');
        app.classList.remove('hidden');
        setTimeout(()=>{ overlay?.parentNode?.removeChild(overlay); }, 500);
      }

      window.addEventListener('load', () => {
        const elapsed = performance.now() - start;
        const remaining = Math.max(0, MIN_LOADING_MS - elapsed);
        setTimeout(finishLoading, remaining);
      });

      setTimeout(() => { if (!overlay.classList.contains('hidden')) finishLoading(); }, 10000);
    })();
  </script>

  <!-- Firebase + l√≥gica -->
  <script type="module" src="./firebase-config.js"></script>
  <script type="module" src="./crear.js"></script>
</body>
</html>
